<div class="coffee-order-container">
  <h2>Order Your Coffee</h2>

  <div *ngIf="orderPlaced" class="success-message">
    <p>✅ Order placed successfully!</p>
  </div>

  <div *ngIf="itemAddedMessage" class="item-added-message">
    <p>{{ itemAddedMessage }}</p>
  </div>

  <div class="main-content">
    <!-- Coffee Menu -->
    <div class="coffee-menu">
      <h3>Select a Coffee</h3>
      <div class="coffee-grid">
        <div
          *ngFor="let coffee of coffees"
          class="coffee-card"
          [class.selected]="selectedCoffee?.id === coffee.id"
          (click)="selectCoffee(coffee)">
          <h4>{{ coffee.name }}</h4>
          <p class="description">{{ coffee.description }}</p>
          <p class="price">${{ coffee.price.toFixed(2) }}</p>
        </div>
      </div>

      <!-- Add to Basket Form -->
      <div *ngIf="selectedCoffee" class="add-to-basket-form">
        <h3>Add to Basket</h3>
        <div class="form-group">
          <label for="quantity">Quantity:</label>
          <input
            type="number"
            id="quantity"
            [(ngModel)]="quantity"
            min="1"
            max="10">
        </div>

        <div class="selected-summary">
          <p><strong>Selected: {{ selectedCoffee.name }}</strong></p>
          <p>Price per cup: ${{ selectedCoffee.price.toFixed(2) }}</p>
          <p>Quantity: {{ quantity }}</p>
          <p class="total">Subtotal: ${{ getTotalPrice().toFixed(2) }}</p>
        </div>

        <button
          (click)="addToBasket()"
          class="add-to-basket-btn">
          Add to Basket
        </button>
      </div>
    </div>

    <!-- Shopping Basket -->
    <div class="shopping-basket">
      <h3>Shopping Basket
        <span *ngIf="getBasketItemCount() > 0" class="basket-count">({{ getBasketItemCount() }} items)</span>
      </h3>

      <div *ngIf="basket.length === 0" class="empty-basket">
        <p>Your basket is empty. Select coffees to add them to your basket!</p>
      </div>

      <div *ngIf="basket.length > 0" class="basket-items">
        <div *ngFor="let item of basket" class="basket-item">
          <div class="item-info">
            <h4>{{ item.coffee.name }}</h4>
            <p class="item-price">${{ item.coffee.price.toFixed(2) }} each</p>
          </div>
          <div class="item-controls">
            <div class="quantity-controls">
              <button
                (click)="updateBasketQuantity(item.coffee.id, item.quantity - 1)"
                class="qty-btn">-</button>
              <span class="quantity">{{ item.quantity }}</span>
              <button
                (click)="updateBasketQuantity(item.coffee.id, item.quantity + 1)"
                class="qty-btn">+</button>
            </div>
            <p class="item-total">${{ (item.coffee.price * item.quantity).toFixed(2) }}</p>
            <button
              (click)="removeFromBasket(item.coffee.id)"
              class="remove-btn">×</button>
          </div>
        </div>

        <div class="basket-summary">
          <div class="basket-total">
            <strong>Total: ${{ getBasketTotal().toFixed(2) }}</strong>
          </div>
        </div>

        <!-- Customer Info and Payment -->
        <div class="checkout-form">
          <div class="form-group">
            <label for="customerName">Your Name:</label>
            <input
              type="text"
              id="customerName"
              [(ngModel)]="customerName"
              placeholder="Enter your name"
              required>
          </div>

          <!-- Payment Method Selection -->
          <div class="form-group">
            <label>Payment Method:</label>
            <div class="payment-options">
              <div
                *ngFor="let option of paymentOptions"
                class="payment-option"
                [class.selected]="selectedPaymentMethod === option.value"
                (click)="selectedPaymentMethod = option.value">
                <span class="payment-icon">{{ option.icon }}</span>
                <span class="payment-label">{{ option.label }}</span>
              </div>
            </div>
          </div>

          <!-- Payment Status Message -->
          <div *ngIf="paymentMessage" class="payment-message">
            <p>{{ paymentMessage }}</p>
          </div>

          <button
            (click)="placeOrder()"
            [disabled]="!customerName.trim() || isProcessingPayment"
            class="place-order-btn"
            [class.processing]="isProcessingPayment">
            <span *ngIf="!isProcessingPayment">
              {{ getPaymentMethodLabel(selectedPaymentMethod) === 'Cash' ? 'Place Order' : 'Pay' }} - ${{ getBasketTotal().toFixed(2) }}
            </span>
            <span *ngIf="isProcessingPayment">
              <span class="spinner"></span>
              Processing...
            </span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
